/* ruote-fluo-all-2.3.0.min.js | MIT license: http://github.com/jmettraux/ruote-fluo/LICENSE.txt */
var RuoteFluoEditor=function(){var o={add_child_expression:"add a child expression",cut_expression:"cut expression",moveup_expression:"move expression up",movedown_expression:"move expression down",paste_expression:"paste expression here"};var g=function(){function q(t,u,v){var s=document.createElement("a");s.callback=v;s.className="rfe_button "+t;s.setAttribute("href","");s.setAttribute("title",u);s.setAttribute("onclick","this.callback(); return false;");return s}function r(v){var s=0;var u=document.createElement("span");u.className="rfe_buttons";u.style.opacity=s;var t=a(v);v.onmouseover=function(){u.style.opacity=1;if(t.onOver){t.onOver(d(v.parentNode))}};v.onmouseout=function(){u.style.opacity=s;if(t.onOver){t.onOver(null)}};u.appendChild(q("rfe_add",RuoteFluoEditor.TEXTS.add_child_expression,function(){RuoteFluoEditor.addExpression(v.parentNode,["---",{},[]])}));if(v.parentNode.parentNode!=t){u.appendChild(q("rfe_cut",RuoteFluoEditor.TEXTS.cut_expression,function(){RuoteFluoEditor.removeExpression(v.parentNode)}));u.appendChild(q("rfe_moveup",RuoteFluoEditor.TEXTS.moveup_expression,function(){RuoteFluoEditor.moveExpression(v.parentNode,-1);u.style.opacity=s}));u.appendChild(q("rfe_movedown",RuoteFluoEditor.TEXTS.movedown_expression,function(){RuoteFluoEditor.moveExpression(v.parentNode,+1);u.style.opacity=s}));u.appendChild(q("rfe_paste",RuoteFluoEditor.TEXTS.paste_expression,function(){var w=document._rfe_clipboard;if(w){RuoteFluoEditor.insertExpression(v.parentNode,w)}}))}v.appendChild(u)}return{render:function(u,v){var D=v[0];var B="";if((typeof v[2][0])==="string"){B=v[2].shift()}var x=John.stringify(v[1]);if(x==="{}"){x=""}else{x=x.slice(1,-1)}x=x.trim();var y=document.createElement("div");y.setAttribute("class","rfe_exp");u.appendChild(y);var t=document.createElement("span");t.setAttribute("class","rfe_exp_span rfe_expression_name");t.appendChild(document.createTextNode(D));y.appendChild(t);var z=document.createElement("span");z.setAttribute("class","rfe_exp_span rfe_expression_atts");z.appendChild(document.createTextNode(" "+x));y.appendChild(z);r(y);var A=function(){var F=y.parentNode;var E=F.parentNode;var G=g.parse(this.value);if(G){F.replaceChild(g.render(F,G),y);j(F)}else{E.removeChild(F);j(E)}};var s=function(E){var F=E||window.event;var G=F.charCode||F.keyCode;if(G===13){this.blur()}return false};var w=function(E){var F=E||window.event;var G=F.charCode||F.keyCode;return(G!=13)};var C=function(){y.removeChild(t);var E=document.createElement("input");E.setAttribute("type","text");E.value=D+" "+x;if(B!=""){E.value=D+" "+B+" "+x}y.replaceChild(E,z);E.onblur=A;E.onkeyup=s;E.onkeypress=w;E.focus()};t.onclick=C;z.onclick=C;return y},parse:function(u){var t=u.match(/^(\S+)(.*)$/);if(t===null||t[1].match(/^-+$/)){return null}return[t[1],John.parse("{"+t[2]+"}"),[]]},toExp:function(t){t=t.firstChild;var s=t.childNodes[0].firstChild.nodeValue;var u=t.childNodes[1].firstChild.nodeValue;return[s,John.parse("{"+u+"}"),[]]}}}();function c(q){if((typeof q)==="string"){q=document.getElementById(q)}return JSON.stringify(h(q))}function i(r,s){var q=document.createElement("div");q.className="rfe_text";if(s[2].length>0){q.appendChild(document.createTextNode("end"))}r.appendChild(q)}function n(r,t){var q=r.lastChild;var s=k(r,t);r.replaceChild(s,q);r.appendChild(q);if(q.childNodes.length===0){q.appendChild(document.createTextNode("end"))}j(r)}function p(q){var r=q.parentNode;r.removeChild(q);if(r.childNodes.length===2){r.lastChild.removeChild(r.lastChild.firstChild)}document._rfe_clipboard=h(q);j(r)}function k(q,u,r){var t=document.createElement("div");t.className="rfe_expression";if(!r){t.setAttribute("style","margin-left: 14px;")}q.appendChild(t);if(!(u instanceof Array)){renderExpressionString(t,u.toString());return}g.render(t,u);for(var s=0;s<u[2].length;s++){k(t,u[2][s])}i(t,u);return t}function f(q,r){if((typeof q)==="string"){q=document.getElementById(q)}q.className="rfe_root";while(q.firstChild){q.removeChild(q.firstChild)}k(q,r,true);q.stack=[];q.currentTree=r}function b(q,s){var r=q.parentNode;if(s===-1){if(q.previousSibling.className!="rfe_expression"){return}r.insertBefore(q,q.previousSibling)}else{if(q.nextSibling.className!="rfe_expression"){return}r.insertBefore(q,q.nextSibling.nextSibling)}RuoteFluoEditor.triggerChange(r)}function e(r,s){var q=k(r.parentNode,s);r.parentNode.insertBefore(q,r);RuoteFluoEditor.triggerChange(r.parentNode)}function j(s){var r=a(s);var q=h(r);l(r,q);if(r.onChange){r.onChange(q)}}function l(r,q){r.stack.push(r.currentTree);r.currentTree=q}function m(r){if((typeof r)==="string"){r=document.getElementById(r)}if(r.stack.length<1){return}while(r.firstChild!=null){r.removeChild(r.firstChild)}var q=r.stack.pop();r.currentTree=q;k(r,q,true);if(r.onChange){r.onChange(q)}}function a(q){if(q.className==="rfe_root"){return q}return a(q.parentNode)}function d(u,x,t){if(x===null){x=a(u);t=""}if(x===u){return t.substring(1,t.length)}var r=x.childNodes;var s=-1;for(var q=0;q<r.length;q++){var w=r[q];if(w.nodeType!=1){continue}if(w.className!="rfe_expression"){continue}s+=1;var v=d(u,w,t+"_"+s);if(v!=null){return v}}return null}function h(r){var q=$(r);q.focus();if(!q.hasClass("rfe_expression")){q=q.children(".rfe_expression").first()}var s=g.toExp(q[0]);q.children(".rfe_expression").each(function(t,u){s[2].push(h(u))});return s}return{TEXTS:o,ExpressionHead:g,render:f,addExpression:n,removeExpression:p,moveExpression:b,insertExpression:e,triggerChange:j,undo:m,asJson:c}}();var FluoEditor=RuoteFluoEditor;$.fn.computedStyle=function(){var f=this.get(0);var b;var h={};if(window.getComputedStyle){var d=function(k,i){return i.toUpperCase()};b=window.getComputedStyle(f,null);for(var g=0,e=b.length;g<e;g++){var a=b[g];var j=a.replace(/\-([a-z])/g,d);var c=b.getPropertyValue(a);h[j]=c}return h}if(b=f.currentStyle){for(var a in b){h[a]=b[a]}return h}if(b=f.style){for(var a in b){if(typeof b[a]!="function"){h[a]=b[a]}}return h}return h};var RuoteFluo=(function(){var r="2.3.0";var k=7;var a=4;var f=this;function c(A){var x=["defs",[]];x[1].push(["marker",{id:"arrowhead",viewBox:"0 0 100 100",refX:"90",refY:"50",markerUnits:"strokeWidth",markerWidth:"10",markerHeight:"10",orient:"auto"},[["path",{"class":"fluo",d:"M 0 0 L 100 50 L 0 100 Z"}]]]);var B=["g",{id:"timer"},[["circle",{"class":"fluo",cx:"14",cy:"14",r:"14",fill:"none",stroke:"black","stroke-width":"1"}],["circle",{"class":"fluo",cx:"14",cy:"14",r:"10",fill:"none",stroke:"black","stroke-width":"1"}],["path",{id:"tt","class":"fluo",d:"M 14 05 L 14 07",fill:"none",stroke:"black","stroke-width":"1"}],]];for(var z=0;z<12;z++){var y=(z+1)*30;B[2].push(["use",{"xlink:href":"#tt",transform:"rotate("+y+", 14, 14)"}])}B[2].push(["path",{"class":"fluo",d:"M 14 10 L 14 14",fill:"none",stroke:"black","stroke-width":"1",transform:"rotate(120, 14, 14)"}]);B[2].push(["path",{"class":"fluo",d:"M 14 08 L 14 14",fill:"none",stroke:"black","stroke-width":"1"}]);x[1].push(B);g(A,x)}function p(D,B,x,C,A){B=B||"svg";x=x||{};A=A||{};var y=document.createElementNS("http://www.w3.org/2000/svg",B);Nu.each(x,function(G,F){var H=null;var E=G.match(/^([a-z]+):([a-z-]+)$/);if(E){H=E[1]}if(H==="xlink"){H="http://www.w3.org/1999/xlink"}if(F instanceof Array){F=F.join(" ")}y.setAttributeNS(H,G,F)});var z=$(y);if(C){z.append(document.createTextNode(C))}D[A.prepend?"prepend":"append"](z);if(B==="svg"){c(z)}return z}function g(C,x){var z=x[0];var y=x[1];var A=x[2]||[];if(y instanceof Array){A=y;y={}}var B=p(C,z,y);Nu.each(A,function(D){g(B,D)});return B}function m(B,z,x,A,y){if(z instanceof Array){return g(B,z)}else{return p(B,z,x,A,y)}}function n(x){if(x.width()===0){return h(x).width}else{return x.width()}}function l(x){if(x.height()===0){return h(x).height}else{return x.height()}}function s(x){return Nu.max(Nu.map(x.children(),function(y){return n($(y))}))}function u(x){return Nu.reduce(Nu.map(x.children(),function(y){return l($(y))}),0,function(z,y){return z+y})}function t(A,z){var x=m(A,"g");var B=0;Nu.each(z,function(C){var y=C;var E="";if(C instanceof Array){E=C[0];y=C[1]}var D=m(x,"text",{"class":$.trim("fluo "+E),x:0},y);B=B+l(D);D.attr("y",B)});x._width=s(x);x._height=u(x);return x}function v(y){var x=Nu.inject(y,0,function(z,A){return Nu.max([z,A._width,A._center||0])});Nu.each(y,function(A){var z=(x-A._width)/2;var B=A._center;if(B){z=(x-B)/2}j(A,z,0)})}function w(y){var x=(y.attr("transform")||"").match(/^translate\((\d+(?:\.\d+)?), (\d+(?:\.\d+)?)\)$/);if(!x){return{x:0,y:0}}return{x:parseFloat(x[1]),y:parseFloat(x[2])}}function h(x){var z=x[0].getBBox();var y=w(x);return{x:y.x,y:y.y,width:z.width,height:z.height}}function j(A,z,C){var B=w(A);A.attr("transform","translate("+(B.x+z)+", "+(B.y+C)+")")}function e(E,y,x,C,B,A){var D=null;var z=a;if(!A.bottom){D=["M",y,x,"L",C+(C>y?-1:1)*z,x,"Q",C,x,C,x+z,"L",C,B];if(A.inner){D=["M"].concat(D.slice(4))}}else{D=["M",y,x,"L",y,B-z,"Q",y,B,y+(C>y?1:-1)*z,B,"L",C,B];if(A.inner){D=D.slice(0,11)}}return m(E,"path",{"class":"fluo rounded_path",d:D,fill:"none"})}function b(x){var y=Nu.find(x[1],function(B,A){return(A===null)});if(y){y=y[0]}var z=Nu.select(x[1],function(B,A){return(A!=null)});return[y,z]}function o(K,E,z,C,y){y=y||{};var A=m(K,"g",{"class":"fluo card"});var H=(y.noCard||y.noRect)?null:m(A,"rect",{"class":"fluo"});var M=null;if(y.noCard){M={_height:0,_width:0}}else{var L=b(z);var B=[["expname",z[0]+(L[0]?" "+L[0]:"")]];Nu.each(L[1],function(N,x){B.push(N+": "+x)});M=t(A,B);j(M,a,0)}var I=M._width;if(!y.noCard){I=I+2*a}var D=m(A,"g",{"class":"fluo card_body"});j(D,I,0);var G=C(D);var J=G[0];var F=G[1];A._width=I+J+(H?a:0);A._height=Nu.max([M._height,F]);if(!y["short"]&&!y.noCard){A._height=A._height+2*a}if(H){H.attr("rx",k);H.attr("ry",k);H.attr("width",""+A._width);H.attr("height",""+A._height)}if(y.rightCentered){A._center=(A._width-J/2-a)*2}A._body=D;return A}var i={};i.text=function(z,y,x){var B=JSON.stringify(x[1]).slice(1,-1);var A=m(z,"text",{"class":"fluo text_exp"},$.trim(x[0]+" "+B));A._width=n(A);A._height=l(A)+a;A.attr("y",l(A));return A};i.any=function(z,y,x){return o(z,y,x,function(D){var B=0;var C=a;var A=0;Nu.each(x[2],function(F){var E=d(D,y+"_"+B,F);j(E,0,C);B=B+1;C=C+E._height+a;A=Nu.max([A,E._width])});return[A,C]})};i.sequence=function(A,y,x){var z=Nu.isEmpty(x[1]);return o(A,y,x,function(F){var D=0;var E=z?0:a;var B=0;var C=Nu.map(x[2],function(I){var G=d(F,y+"_"+D,I);j(G,0,E);D=D+1;E=E+G._height;B=Nu.max([B,G._width]);if(D>=x[2].length){return G}var H=m(F,"path",{"class":"fluo",d:"M 0 0 L 0 11","marker-end":"url(#arrowhead)"});j(H,0,E);E=E+11;H._width=n(H);H._height=l(H);return[G,H]});v(Nu.flatten(C));return[B,E]},{noCard:z})};i.concurrence=function(B,z,x){var D=o(B,z,x,function(H){var F=0;var E=0;var G=Nu.map(x[2],function(J){var I=d(H,z+"_"+F,J);j(I,E,a);E=E+I._width+a;F=F+1;return I._height});return[E-a,Nu.max(G)]},{noRect:true,rightCentered:true});var C=n(D._body);var y=0;var A=D._body.children().length;Nu.each(D._body.children(),function(I){y=y+1;var H=$(I);var F=n(H);var G=l(H);var E=w(H).x;e(D._body,C/2-a,0,E+F/2,a,{bottom:false,inner:y>1&&y<A});e(D._body,E+F/2,G+a,C/2-a,D._height,{bottom:true,inner:y>1&&y<A})});return D};i.wait=function(z,y,x){return o(z,y,x,function(A){var B=m(A,"use",{"xlink:href":"#timer"});return[2*a+n(B),l(B)]},{noRect:true,"short":true,rightCentered:true})};i.sleep=i.wait;Nu.each(["set","rset","unset","rewind","continue","back","break","stop","cancel","skip","jump"],function(x){i[x]=i.text});function d(A,z,y){var x=(i[y[0]]||i.any).call(f,A,z,y);x[0].id="exp_"+z;return x}function q(x){return $(((typeof x)==="string")?"#"+x:x)}this.render=function(z,x,y){y=y||{};$div=q(z);$div.empty();$div[0].fluo_options=y;$g=d(m($div),"0",x);if(y.noOuterBorder){$g.children("rect").remove()}$svg=$g.parent();$svg.attr("width",$g._width+3);$svg.attr("height",$g._height+3);return $g};this.highlight=function(D,B){var z=q(D);$("#"+z[0].id+" rect.fluo_highlight").remove();var A=$("#exp_"+B);if(A.length<1){return}var y=h(A);var x=m(A.parent(),"rect",{"class":"fluo_highlight"},null,{prepend:true});var C=parseFloat(x.computedStyle()["stroke-width"]||"3")+1;x.attr({x:y.x-C,y:y.y-C,width:y.width+2*C,height:y.height+2*C,rx:C,ry:C})};this.pin=function(x,A,F,y){F="fluo_pin_"+F;y=y||"wi";var H=q(x);var z=$("#exp_"+A);if(z.length<1){return}var I=h(z);var J=20;var C=10;var D=40;var G=15;var K=m(z.parent(),"g");var E=m(K,"path",{d:["M",0,G,"L",C,D,"L",J,G,"Q",C,0,0,G],"class":F});var B=m(K,"text",{"class":F,x:J/4,y:D/2},y);v([E,B]);j(K,I.x+I.width-18,I.y-20)};return this}).apply({});var Fluo=RuoteFluo;
/* compressed from commit c63a9ac */
